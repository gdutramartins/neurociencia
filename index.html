<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Nervoso Central - Visualização Interativa</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            margin: 0;
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-style: italic;
            margin-top: 8px;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            min-height: 700px;
        }
        
        #network {
            flex: 1;
            padding: 30px;
            border-right: 1px solid #eee;
        }
        
        .sidebar {
            width: 350px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .node {
            stroke: #fff;
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            stroke: #ffeb3b;
            stroke-width: 4px;
            r: 35;
        }
        
        .node.selected {
            stroke: #ff9800;
            stroke-width: 4px;
            filter: drop-shadow(0 0 10px rgba(255, 152, 0, 0.8));
            r: 35;
        }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.8;
            stroke-width: 2px;
            fill: none;
        }
        
        .link.highlighted {
            stroke: #e74c3c;
            stroke-width: 3px;
            stroke-opacity: 1;
            filter: drop-shadow(0 0 4px rgba(231, 76, 60, 0.5));
        }
        
        .node-label {
            font-size: 14px;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
        }
        
        .link-label {
            font-size: 11px;
            fill: #666;
            font-weight: 500;
            text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }
        
        .close-button:hover {
            color: #333;
        }
        
        .modal-title {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        
        .modal-body {
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .info-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .info-section:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .info-section h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-section h4::after {
            content: "↗";
            font-size: 18px;
            color: #3498db;
        }
        
        .info-section p {
            margin: 0;
            color: #555;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            font-size: 14px;
            z-index: 999;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .instructions {
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            border-left: 4px solid #2196f3;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1565c0;
        }
        
        .legend {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .legend h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            margin-right: 10px;
            border-radius: 50%;
        }
        
        .legend-line {
            width: 35px;
            height: 3px;
            margin-right: 10px;
            background-color: #999;
        }
        
        .context-menu {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            z-index: 100;
            width: 180px;
        }
        
        .context-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .context-menu li {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .context-menu li:last-child {
            border-bottom: none;
        }
        
        .context-menu li:hover {
            background-color: #f0f8ff;
            color: #2196f3;
        }
        
        #node-info {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .node-info-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .node-color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .section-modal {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sistema Nervoso Central - Visualização Interativa</h1>
            <p class="subtitle">Explore os principais centros de processamento e suas conexões</p>
        </header>
        
        <div class="content">
            <div id="network"></div>
            
            <div class="sidebar">
                <div class="instructions">
                    <h3>Como usar</h3>
                    <p>• Clique em um nó para destacar suas conexões</p>
                    <p>• Passe o mouse sobre um nó para ver informações</p>
                    <p>• Clique com o botão direito para ver opções detalhadas</p>
                    <p>• Clique em qualquer seção de informações para expandir</p>
                </div>
                
                <h3 id="selected-node-title">Nenhum nó selecionado</h3>
                <div id="node-info">
                    <p>Selecione um nó para ver informações detalhadas.</p>
                </div>
                
                <div class="legend">
                    <h3>Legenda</h3>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #1f77b4;"></div>
                        <span>Medula Espinhal</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff7f0e;"></div>
                        <span>Tronco Encefálico</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2ca02c;"></div>
                        <span>Cerebelo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line"></div>
                        <span>Conexão neural</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 30px; height: 15px; margin-right: 10px; background-color: #2ca02c;"></div>
                        <span>Conexão aferente (entrada)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 30px; height: 15px; margin-right: 10px; background-color: #d62728;"></div>
                        <span>Conexão eferente (saída)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 30px; height: 15px; margin-right: 10px; background-color: #3498db;"></div>
                        <span>Conexão bidirecional</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn" id="reset-btn">Redefinir Visualização</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal principal -->
    <div class="modal" id="info-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 class="modal-title" id="modal-title">Detalhes do Nó</h3>
            <div class="modal-body" id="modal-body">
                <!-- O conteúdo será preenchido via JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Modais para cada seção -->
    <div class="modal section-modal" id="functions-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 class="modal-title" id="functions-modal-title">Funções</h3>
            <div class="modal-body" id="functions-modal-body">
                <!-- O conteúdo será preenchido via JavaScript -->
            </div>
        </div>
    </div>
    
    <div class="modal section-modal" id="dysfunctions-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 class="modal-title" id="dysfunctions-modal-title">Disfunções</h3>
            <div class="modal-body" id="dysfunctions-modal-body">
                <!-- O conteúdo será preenchido via JavaScript -->
            </div>
        </div>
    </div>
    
    <div class="modal section-modal" id="details-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 class="modal-title" id="details-modal-title">Detalhes</h3>
            <div class="modal-body" id="details-modal-body">
                <!-- O conteúdo será preenchido via JavaScript -->
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <div class="context-menu" id="context-menu">
        <ul>
            <li data-option="functions">Ver Funções</li>
            <li data-option="dysfunctions">Ver Disfunções</li>
            <li data-option="details">Ver Detalhes</li>
        </ul>
    </div>

    <script>
        // Dados dos nós (centros de processamento do sistema nervoso central)
        const nodes = [
            { id: "medula", name: "Medula Espinhal", x: 600, y: 600, color: "#1f77b4" },
            { id: "tronco", name: "Tronco Encefálico", x: 600, y: 350, color: "#ff7f0e" },
            { id: "cerebelo", name: "Cerebelo", x: 300, y: 300, color: "#2ca02c" },
            { id: "amigdala", name: "Amígdala", x: 800, y: 250, color: "#d62728" },
            { id: "nucleos", name: "Núcleos da Base", x: 350, y: 150, color: "#9467bd" },
            { id: "neocortex", name: "Neocórtex", x: 600, y: 50, color: "#8c564b" },
            { id: "talamo", name: "Tálamo", x: 750, y: 150, color: "#e377c2" },
            { id: "hipotalamo", name: "Hipotálamo", x: 850, y: 350, color: "#7f7f7f" }
        ];

        // Dados das conexões (relacionamentos entre os nós)
        const links = [
            { source: "medula", target: "tronco", type: "bidirectional", label: "Via espinhal" },
            { source: "tronco", target: "cerebelo", type: "bidirectional", label: "Pedúnculos" },
            { source: "tronco", target: "amigdala", type: "afferent", label: "Via aferente" },
            { source: "tronco", target: "talamo", type: "afferent", label: "Via sensorial" },
            { source: "tronco", target: "hipotalamo", type: "efferent", label: "Via autonômica" },
            { source: "cerebelo", target: "nucleos", type: "efferent", label: "Via motora" },
            { source: "amigdala", target: "hipotalamo", type: "efferent", label: "Resposta emocional" },
            { source: "nucleos", target: "talamo", type: "efferent", label: "Via talâmica" },
            { source: "neocortex", target: "talamo", type: "bidirectional", label: "Radições talâmicas" },
            { source: "neocortex", target: "nucleos", type: "efferent", label: "Via córtico-nuclear" },
            { source: "neocortex", target: "amigdala", type: "bidirectional", label: "Conexão límbica" },
            { source: "talamo", target: "hipotalamo", type: "bidirectional", label: "Via diencefálica" },
            { source: "talamo", target: "neocortex", type: "afferent", label: "Projeções" },
            { source: "hipotalamo", target: "tronco", type: "efferent", label: "Resposta autonômica" },
            { source: "medula", target: "cerebelo", type: "afferent", label: "Via espinocerebelar" },
            { source: "talamo", target: "cerebelo", type: "efferent", label: "Via cerebelotalâmica" }
        ];

        // Informações detalhadas sobre cada nó
        const nodeInfo = {
            "medula": {
                functions: "A medula espinhal é responsável pela condução de impulsos nervosos entre o cérebro e o resto do corpo. Ela também controla reflexos simples e funções autonômicas como sudorese, dilatação de vasos sanguíneos e controle da bexiga. Atua como um centro de processamento para informações sensoriais e motoras, permitindo respostas rápidas a estímulos sem a necessidade de envolvimento cerebral.",
                dysfunctions: "Lesões na medula espinhal podem resultar em paralisia, perda de sensibilidade e disfunções autonômicas. Dependendo do nível da lesão, pode haver paraplegia (paralisia dos membros inferiores) ou tetraplegia (paralisia de todos os quatro membros). Outras disfunções incluem incontinência urinária e fecal, disfunção sexual, espasticidade muscular e dor neuropática. Doenças como esclerose múltipla e poliomielite também podem afetar a medula espinhal.",
                details: "A medula espinhal é uma estrutura cilíndrica alongada que se estende desde o forame magno do occipital até a primeira ou segunda vértebra lombar. É envolta pelas meninges (dura-máter, aracnoide e pia-máter) e protegida pela coluna vertebral. É dividida em 31 segmentos: 8 cervicais, 12 torácicos, 5 lombares, 5 sacrais e 1 coccígeo. Cada segmento dá origem a um par de nervos espinhais que se conectam com diferentes partes do corpo."
            },
            "tronco": {
                functions: "O tronco encefálico controla funções vitais como respiração, frequência cardíaca e pressão arterial. Também regula o ciclo sono-vigília, o alerta e a consciência. Serve como via de passagem para todas as fibras nervosas que conectam o cérebro à medula espinhal e contém os núcleos da maioria dos nervos cranianos. Participa do controle de reflexos como o vômito, tosse, espirro e deglutição.",
                dysfunctions: "Lesões no tronco encefálico podem causar coma, distúrbios do sono, problemas respiratórios ou cardíacos. A síndrome de locked-in resulta de danos à ponte, onde o paciente está consciente mas incapaz de se mover ou falar. Outras condições incluem acidente vascular cerebral (AVC) do tronco encefálico, tumores como gliomas, e doenças neurodegenerativas como esclerose lateral amiotrófica (ELA).",
                details: "O tronco encefálico localiza-se na base do cérebro, conectando-o com a medula espinhal. É composto por três estruturas principais: mesencéfalo, ponte e bulbo (medula oblonga). Contém numerosos núcleos de nervos cranianos (III a XII) e centros vitais como o centro respiratório e cardiovascular. A formação reticular, uma rede neural difusa no tronco encefálico, é crucial para a regulação da consciência e do estado de alerta."
            },
            "cerebelo": {
                functions: "O cerebelo é fundamental para a coordenação motora, equilíbrio, tônus muscular e aprendizagem motora. Ajusta e refine os movimentos voluntários, garantindo precisão e timing adequado. Participa do controle postural e do equilíbrio, integrando informações vestibulares, proprioceptivas e visuais. Também está envolvido em funções cognitivas como atenção, processamento linguístico e regulação emocional.",
                dysfunctions: "Disfunções cerebelares causam ataxia (falta de coordenação muscular), tremores, nistagmo (movimentos oculares involuntários), disartria (dificuldade na articulação da fala) e hipotonia (tônus muscular reduzido). Condições como ataxia de Friedreich, malformação de Chiari, tumores cerebelares e degeneração alcoólica podem afetar o cerebelo. Lesões podem resultar em síndromes como a síndrome do vermis ou síndrome hemisférica cerebelar.",
                details: "O cerebelo localiza-se na fossa craniana posterior, abaixo do lobo occipital do cérebro. É dividido em dois hemisférios conectados pelo vermis. Sua estrutura inclui um córtex altamente pregueado com inúmeras camadas celulares. Contém mais da metade de todos os neurônios do encéfalo, apesar de representar apenas 10% do volume encefálico. Recebe input de quase todos os sistemas sensoriais e projeta para várias áreas motoras."
            },
            "amigdala": {
                functions: "A amígdala processa emoções, especialmente medo e prazer, e está envolvida na formação de memórias emocionais. Desempenha papel crucial na resposta a estímulos ameaçadores e na modulação de respostas autonômicas e endócrinas a estímulos emocionais. Participa do reconhecimento de expressões faciais emocionais e da tomada de decisões baseadas em emoções. Também está envolvida no comportamento sexual e agressivo.",
                dysfunctions: "Disfunções na amígdala estão associadas a ansiedade, transtorno de estresse pós-traumático, fobias, depressão e dificuldades com memória emocional. A síndrome de Urbach-Wiethe causa calcificação bilateral da amígdala, resultando em diminuição do reconhecimento do medo. Autismo e esquizofrenia também apresentam alterações na função amigdaliana. Hiperatividade amigdaliana está correlacionada com transtornos de ansiedade.",
                details: "A amígdala é um conjunto de núcleos em forma de amêndoa localizados no lobo temporal medial, anterior ao hipocampo. Faz parte do sistema límbico e é dividida em vários subnúcleos com funções distintas. Recebe informações de múltiplos sistemas sensoriais e se conecta com diversas regiões cerebrais incluindo hipotálamo, tronco encefálico e córtex pré-frontal. Desempenha papel central no processamento emocional e na modulação de memórias."
            },
            "nucleos": {
                functions: "Os núcleos da base controlam movimentos voluntários, aprendizagem de hábitos, cognição e emoções. Modulam a atividade cortical para produzir movimentos suaves e coordenados. Participam do planejamento e iniciação de movimentos, controle postural e aprendizagem procedural. Também estão envolvidos em funções cognitivas como atenção, tomada de decisões e processamento de recompensas.",
                dysfunctions: "Doenças dos núcleos da base incluem doença de Parkinson (degeneração da substância nigra), coreia de Huntington (degeneração progressiva), distonia (contrações musculares sustentadas), hemibalismo (movimentos violentos involuntários) e síndrome de Tourette (tiques motores e vocais). Estas condições resultam em distúrbios do movimento como tremor, rigidez, acinesia e discinesia.",
                details: "Os núcleos da base são um grupo de estruturas subcorticais interconectadas que incluem o corpo estriado (putâmen e núcleo caudado), globo pálido, núcleo subtalâmico e substância nigra. Formam circuitos complexos com o córtex cerebral e o tálamo. Utilizam principalmente o neurotransmissor GABA, com modulação dopaminérgica da substância nigra. São cruciais para o controle motor, aprendizagem de hábitos e processamento de recompensas."
            },
            "neocortex": {
                functions: "O neocórtex é responsável pelo pensamento consciente, percepção sensorial, linguagem, raciocínio e tomada de decisões. Processa informações sensoriais de todos os sentidos e inicia movimentos voluntários. É o substrato neural da consciência, memória explícita, atenção e funções executivas. Áreas especializadas incluem o córtex visual (visão), auditivo (audição), somatossensorial (tato) e motor (movimento).",
                dysfunctions: "Lesões corticais podem causar afasia (distúrbios de linguagem), agnosia (incapacidade de reconhecer objetos), apraxia (incapacidade de realizar movimentos voluntários), demências (como Alzheimer), epilepsia e distúrbios psiquiátricos. Acidentes vasculares cerebrais, traumatismos cranianos, tumores e infecções podem danificar áreas específicas do córtex, resultando em deficits neurológicos específicos.",
                details: "O neocórtex é a camada externa do cérebro, com espessura de 2-4mm e altamente pregueada formando giros e sulcos. É dividido em lobos frontais (funções executivas), parietais (integração sensorial), temporais (audição e memória) e occipitais (visão). Possui seis camadas histológicas distintas com diferentes tipos neuronais. É exclusivo de mamíferos e mais desenvolvido em primatas e humanos, onde ocupa cerca de 76% do volume cerebral."
            },
            "talamo": {
                functions: "O tálamo atua como estação de retransmissão sensorial, processando e direcionando informações sensoriais para o córtex cerebral apropriado. Regula a consciência, alerta e sono através de suas conexões com a formação reticular. Participa da integração sensitivo-motora e modulação da atividade cortical. Também está envolvido na regulação de emoções e memória através de suas conexões com o sistema límbico.",
                dysfunctions: "Distúrbios talâmicos podem causar problemas sensoriais como perda ou distorção da sensibilidade, dor talâmica (síndrome de Dejerine-Roussy), problemas de atenção, distúrbios do sono e movimentos anormais. Lesões vasculares (como infartos talâmicos) são comuns devido à irrigação arterial vulnerável. Tumores, esclerose múltipla e degeneração também podem afetar o tálamo.",
                details: "O tálamo é uma grande estrutura oval localizada no diencéfalo, acima do tronco encefálico. É composto por vários núcleos especializados que processam diferentes modalidades sensoriais (excepto olfato). Cada núcleo talâmico se conecta com áreas corticais específicas, formando circuitos recíprocos. Atua como filtro sensorial, regulando quais informações alcançam a consciência. Também participa da regulação do estado de alerta e consciência."
            },
            "hipotalamo": {
                functions: "O hipotálamo regula a homeostase corporal, incluindo temperatura, fome, sede, balanço hídrico e ritmo circadiano. Controla o sistema endócrino através da hipófise, regulando hormônios e funções como crescimento, metabolismo e reprodução. Modula respostas autonômicas e está envolvido em emoções como raiva e medo. Integra informações viscerais, autonômicas e endócrinas para manter a constância do ambiente interno.",
                dysfunctions: "Distúrbios hipotalâmicos podem causar desregulação térmica (hipertermia ou hipotermia), distúrbios alimentares (hiperfagia ou anorexia), diabetes insípido (deficiência de ADH), distúrbios do sono, puberdade precoce ou tardia e alterações emocionais. Tumores como craniofaringioma, hamartomas e gliomas podem comprimir o hipotálamo. Lesões podem resultar em distúrbios autonômicos e endócrinos graves.",
                details: "O hipotálamo é uma pequena região na base do cérebro, abaixo do tálamo e acima da hipófise. Pesando apenas 4g, é composto por vários núcleos com funções especializadas. Conecta o sistema nervoso ao sistema endócrino através do eixo hipotálamo-hipófise. Recebe input de várias regiões cerebrais e periféricas, integrando informações sobre estado corporal, ambiente externo e ritmos circadianos. É crucial para a sobrevivência e comportamento adaptativo."
            }
        };

        // Configuração do SVG e da visualização
        const width = document.getElementById('network').clientWidth;
        const height = window.innerHeight - document.querySelector('header').clientHeight - 40;
        
        const svg = d3.select('#network')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // Definições para marcações de setas
        svg.append('defs').selectAll('marker')
            .data(['afferent', 'efferent', 'bidirectional'])
            .enter().append('marker')
            .attr('id', d => d)
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 38)  // Ajustado para que a seta termine na borda do nó
            .attr('refY', 0)
            .attr('markerWidth', 8)
            .attr('markerHeight', 8)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', d => {
                if (d === 'afferent') return '#2ca02c';
                if (d === 'efferent') return '#d62728';
                return '#3498db';
            });
        
        // Desenhar as ligações
        const link = svg.append('g')
            .selectAll('line')
            .data(links)
            .enter().append('line')
            .attr('class', 'link')
            .attr('marker-end', d => `url(#${d.type})`);
        
        // Adicionar rótulos para as ligações
        const linkLabel = svg.append('g')
            .selectAll('text')
            .data(links)
            .enter().append('text')
            .attr('class', 'link-label')
            .text(d => d.label);
        
        // Desenhar os nós (agora maiores)
        const node = svg.append('g')
            .selectAll('circle')
            .data(nodes)
            .enter().append('circle')
            .attr('class', 'node')
            .attr('r', 30)  // Aumentado de 20 para 30
            .attr('cx', d => d.x)
            .attr('cy', d => d.y)
            .attr('fill', d => d.color);
        
        // Adicionar rótulos aos nós
        const label = svg.append('g')
            .selectAll('text')
            .data(nodes)
            .enter().append('text')
            .attr('class', 'node-label')
            .attr('x', d => d.x)
            .attr('y', d => d.y)
            .attr('dy', -35)  // Ajustado para acomodar o nó maior
            .attr('text-anchor', 'middle')
            .text(d => d.name);
        
        // Calcular posição da seta para terminar na borda do nó
        function calculateArrowPosition(source, target, radius) {
            const dx = target.x - source.x;
            const dy = target.y - source.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const ratio = (distance - radius) / distance;
            
            return {
                x: source.x + dx * ratio,
                y: source.y + dy * ratio
            };
        }
        
        // Atualizar a posição dos elementos
        function update() {
            link
                .attr('x1', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    if (!sourceNode || !targetNode) return 0;
                    
                    const startPoint = calculateArrowPosition(targetNode, sourceNode, 30);
                    return startPoint.x;
                })
                .attr('y1', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    if (!sourceNode || !targetNode) return 0;
                    
                    const startPoint = calculateArrowPosition(targetNode, sourceNode, 30);
                    return startPoint.y;
                })
                .attr('x2', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    if (!sourceNode || !targetNode) return 0;
                    
                    const endPoint = calculateArrowPosition(sourceNode, targetNode, 30);
                    return endPoint.x;
                })
                .attr('y2', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    if (!sourceNode || !targetNode) return 0;
                    
                    const endPoint = calculateArrowPosition(sourceNode, targetNode, 30);
                    return endPoint.y;
                });
            
            // Atualizar posição dos rótulos das ligações
            linkLabel
                .attr('x', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    return sourceNode && targetNode ? (sourceNode.x + targetNode.x) / 2 : 0;
                })
                .attr('y', d => {
                    const sourceNode = nodes.find(n => n.id === d.source);
                    const targetNode = nodes.find(n => n.id === d.target);
                    return sourceNode && targetNode ? (sourceNode.y + targetNode.y) / 2 - 10 : 0;
                });
            
            node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);
            
            label
                .attr('x', d => d.x)
                .attr('y', d => d.y);
        }
        
        update();
        
        // Interatividade
        const tooltip = d3.select('#tooltip');
        const mainModal = document.getElementById('info-modal');
        const functionsModal = document.getElementById('functions-modal');
        const dysfunctionsModal = document.getElementById('dysfunctions-modal');
        const detailsModal = document.getElementById('details-modal');
        const contextMenu = document.getElementById('context-menu');
        
        // Função para mostrar um modal de seção
        function showSectionModal(modal, title, content) {
            document.getElementById(`${modal.id}-title`).textContent = title;
            document.getElementById(`${modal.id}-body`).innerHTML = `<p>${content}</p>`;
            modal.style.display = 'flex';
        }
        
        // Fechar todos os modais
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // Eventos de mouse para os nós
        node.on('mouseover', function(event, d) {
            // Mostrar tooltip
            tooltip
                .style('opacity', 1)
                .html(`<strong>${d.name}</strong><br/>Clique para mais detalhes`)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 25) + 'px');
            
            // Destacar o nó
            d3.select(this).attr('r', 35);
        })
        .on('mouseout', function(event, d) {
            // Esconder tooltip
            tooltip.style('opacity', 0);
            
            // Voltar ao tamanho normal se não estiver selecionado
            if (!d3.select(this).classed('selected')) {
                d3.select(this).attr('r', 30);
            }
        })
        .on('click', function(event, d) {
            // Remover seleção anterior
            node.classed('selected', false);
            link.classed('highlighted', false);
            
            // Selecionar este nó
            d3.select(this).classed('selected', true);
            
            // Destacar conexões relacionadas
            link.classed('highlighted', l => 
                l.source === d.id || l.target === d.id
            );
            
            // Atualizar informações na sidebar
            document.getElementById('selected-node-title').textContent = d.name;
            document.getElementById('node-info').innerHTML = `
                <div class="node-info-header">
                    <div class="node-color-indicator" style="background-color: ${d.color};"></div>
                    <h3>${d.name}</h3>
                </div>
                <div class="info-section" data-node="${d.id}" data-section="functions">
                    <h4>Funções</h4>
                    <p>${nodeInfo[d.id].functions}</p>
                </div>
                <div class="info-section" data-node="${d.id}" data-section="dysfunctions">
                    <h4>Disfunções</h4>
                    <p>${nodeInfo[d.id].dysfunctions}</p>
                </div>
                <div class="info-section" data-node="${d.id}" data-section="details">
                    <h4>Detalhes</h4>
                    <p>${nodeInfo[d.id].details}</p>
                </div>
            `;
            
            // Adicionar event listeners para as seções
            document.querySelectorAll('.info-section').forEach(section => {
                section.addEventListener('click', function() {
                    const nodeId = this.getAttribute('data-node');
                    const sectionType = this.getAttribute('data-section');
                    const title = `${nodes.find(n => n.id === nodeId).name} - ${this.querySelector('h4').textContent}`;
                    const content = nodeInfo[nodeId][sectionType];
                    
                    if (sectionType === 'functions') {
                        showSectionModal(functionsModal, title, content);
                    } else if (sectionType === 'dysfunctions') {
                        showSectionModal(dysfunctionsModal, title, content);
                    } else if (sectionType === 'details') {
                        showSectionModal(detailsModal, title, content);
                    }
                });
            });
            
            event.stopPropagation();
        })
        .on('contextmenu', function(event, d) {
            event.preventDefault();
            
            // Mostrar menu de contexto
            contextMenu.style.display = 'block';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            
            // Armazenar o nó selecionado no menu
            contextMenu.setAttribute('data-node', d.id);
        });
        
        // Adicionar capacidade de arrastar aos nós
        node.call(d3.drag()
            .on('start', function(event, d) {
                d3.select(this).raise().attr('stroke', 'black');
            })
            .on('drag', function(event, d) {
                d.x = event.x;
                d.y = event.y;
                update();
            })
            .on('end', function(event, d) {
                d3.select(this).attr('stroke', null);
            })
        );
        
        // Fechar o menu de contexto ao clicar em outro lugar
        document.addEventListener('click', () => {
            contextMenu.style.display = 'none';
        });
        
        // Lidar com as opções do menu de contexto
        document.querySelectorAll('#context-menu li').forEach(item => {
            item.addEventListener('click', function() {
                const option = this.getAttribute('data-option');
                const nodeId = contextMenu.getAttribute('data-node');
                const nodeData = nodes.find(n => n.id === nodeId);
                
                if (option === 'functions') {
                    showSectionModal(functionsModal, `${nodeData.name} - Funções`, nodeInfo[nodeId].functions);
                } else if (option === 'dysfunctions') {
                    showSectionModal(dysfunctionsModal, `${nodeData.name} - Disfunções`, nodeInfo[nodeId].dysfunctions);
                } else if (option === 'details') {
                    showSectionModal(detailsModal, `${nodeData.name} - Detalhes`, nodeInfo[nodeId].details);
                }
                
                contextMenu.style.display = 'none';
            });
        });
        
        // Fechar os modais
        document.querySelectorAll('.close-button').forEach(button => {
            button.addEventListener('click', () => {
                closeAllModals();
            });
        });
        
        // Fechar os modais ao clicar fora deles
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                closeAllModals();
            }
        });
        
        // Botão de redefinir
        document.getElementById('reset-btn').addEventListener('click', () => {
            // Reposicionar nós
            nodes.forEach((node, i) => {
                node.x = [600, 600, 300, 800, 350, 600, 750, 850][i];
                node.y = [600, 350, 300, 250, 150, 50, 150, 350][i];
            });
            
            // Remover seleções
            node.classed('selected', false);
            link.classed('highlighted', false);
            
            // Atualizar visualização
            update();
            
            // Limpar informações
            document.getElementById('selected-node-title').textContent = 'Nenhum nó selecionado';
            document.getElementById('node-info').innerHTML = '<p>Selecione um nó para ver informações detalhadas.</p>';
        });
        
        // Ajustar o tamanho do SVG quando a janela for redimensionada
        window.addEventListener('resize', () => {
            const newWidth = document.getElementById('network').clientWidth;
            const newHeight = window.innerHeight - document.querySelector('header').clientHeight - 40;
            
            svg.attr('width', newWidth).attr('height', newHeight);
            update();
        });
    </script>
</body>
</html>
